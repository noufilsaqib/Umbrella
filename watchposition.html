<!DOCTYPE html>
<html>
<body>

<p>Click the button to get your coordinates.</p>

<button onclick="getLocation()">Start Tracking</button>
<!-- <button onclick="stopTracking()">Stop Tracking</button> -->
<p id="distance"> </p>

<script>

var distance = document.getElementById("distance");
var geolocationID;

function getLocation() {
  if (navigator.geolocation) {
    var geolocationID = navigator.geolocation.watchPosition(getDistanceToHost,error,options);
  } else { 
    distance.innerHTML = "Geolocation is not supported by this browser.";
  }
}
 
// Show current position
function showPosition(position) {
    distance.innerHTML="Latitude: " + position.coords.latitude + 
    "<br>Longitude: " + position.coords.longitude;
}

// Get shortest distance to Host in km
function getDistanceToHost(position) {
    var hostLatitude  = 49.268568;
    var hostLongtitude = -122.790790;
    var dist = getDistanceInKm(position.coords.latitude,position.coords.longitude,hostLatitude,hostLongtitude);
    distance.innerHTML = "Distance to Host: " + dist.toPrecision(3) + " km" ;
}

// calculate distance in km
function getDistanceInKm(lat1,lon1,lat2,lon2) {
  var R = 6371; // Radius of the earth in km
  var dLat = deg2rad(lat2-lat1);  // deg2rad below
  var dLon = deg2rad(lon2-lon1); 
  var a = 
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
    Math.sin(dLon/2) * Math.sin(dLon/2)
    ; 
  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
  var d = R * c; // Distance in km
  return d;
}

function deg2rad(deg) {
  return deg * (Math.PI/180)
}


function stopTracking() {
    if (navigator.geolocation) {
        navigator.geolocation.clearWatch(geolocationID);
        distance.innerHTML ="";
    } else { 
        distance.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function error(err) {
  console.warn('ERROR(' + err.code + '): ' + err.message);
}

options = {
  enableHighAccuracy: true
};

</script>




</body>
</html>

<!-- 

Create objects:
member
    ID
    name
    email
    phone
    currentPosition: longitude, latitude
    trackingEnable
    partyList: list of party (assume 1 party in the first stage)
        partyID
        attending: yes/no,tentative
        isSafe:

Host
    ID
    name 
    email
    phone
    hostedPartyList
        partyID    

Party
    ID
    HostID
    address
    posistion: longitude, latitude
    startTime
    endTime
    safetyDistance???
    guessList: list of guess ID
        guessID
        attending: yes/no,tentative
        isSafe:

action

Member action: login, select party: 
    Track distance
            getPartyInfo(partyID)
            getDistanceToHost(current position, party posistion)
                Update member's current position to DB
            sendAlarm
            confirmSafe
    confirmAttending: yes/no,tentative    


Host: login, select party to modify, update or to create a new party
    create/update/cancel: Party

    sendInvitationToGuestList

    addGuess

    sendAnnouncement

    getAttendanceList -->




